<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Term Project: Hardware &amp; Electrical Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 405 Term Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('hardware.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Hardware &amp; Electrical Design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2 class="doxsection"><a class="anchor" id="autotoc_md45"></a>
System Overview</h2>
<p>The Romi robot is built on a Pololu Romi chassis and controlled using an ST Nucleo development board running MicroPython. The hardware and electrical design emphasizes predictable startup behavior, clean signal routing, and modular interfaces that support incremental development, debugging, and future extension.</p>
<p>Major subsystems integrated into the robot include:</p><ul>
<li>Dual DC motors with quadrature encoders</li>
<li>Reflectance-based line sensor array</li>
<li>Inertial Measurement Unit (IMU)</li>
<li>Bluetooth communication module</li>
<li>Battery-powered system with onboard voltage monitoring</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md47"></a>
Microcontroller and Power System</h2>
<p>The system is powered by <b>six AA batteries</b>, routed through a power distribution board (PDB). Battery voltage is supplied to the Nucleo board via the VIN pin. A resistive voltage divider feeds an ADC input, allowing real-time measurement of battery voltage during operation.</p>
<p>This measurement is used to compensate for battery voltage droop in the motor control pipeline, improving repeatability over the duration of a run.</p>
<p>Startup behavior was treated as a primary design constraint. Motor driver enable (nSLP) pins are explicitly controlled in software, and pin selections were chosen to prevent unintended motor motion during power-up or reset. Pull-down configurations and initialization order were carefully managed to ensure safe and predictable behavior.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md49"></a>
Motor Driver Interfaces</h2>
<p>Each motor is driven using three signals:</p><ul>
<li>PWM signal for effort command</li>
<li>Direction signal</li>
<li>Sleep/enable (nSLP) signal</li>
</ul>
<p>Hardware timers were selected to generate PWM outputs independently for each motor without conflicting with encoder timers or communication peripherals. Motor enable pins are controlled as standard digital outputs to enforce explicit enable/disable behavior in firmware.</p>
<p>This structure ensures motors remain disabled until the system has fully initialized and the scheduler has started.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md51"></a>
Quadrature Encoder Interfaces</h2>
<p>Wheel encoders are interfaced using hardware timer encoder modes. This approach offloads quadrature decoding to dedicated timer hardware, providing robust position and velocity measurements with minimal CPU overhead.</p>
<p>Separate timers are used for the left and right encoders to allow fully independent velocity estimation and closed-loop control. Encoder wiring and pin selection were chosen to avoid overlap with PWM, ADC, and communication peripherals.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md53"></a>
Line Sensor Array</h2>
<p>Line detection is performed using a multi-channel reflectance sensor array mounted at the front of the chassis. Individual sensors are read using ADC inputs distributed across multiple GPIO ports to balance pin availability and minimize conflicts with timers and communication interfaces.</p>
<p>Although only a subset of sensors is used for control during line following, all channels are wired and supported in firmware. This provided flexibility during development and allowed sensor selection and weighting strategies to evolve without hardware changes.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md55"></a>
IMU Interface</h2>
<p>An IMU is connected via the I2C2 peripheral. Dedicated SDA and SCL pins were selected to avoid interference with timers, ADC inputs, and UART communication.</p>
<p>The IMU is supported in firmware and was used extensively during Lab 0x05 for state estimation experiments. Although it was not relied upon for the final line-following implementation, its integration provided valuable insight into system dynamics and informed later design decisions.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md57"></a>
Bluetooth Communication Interface</h2>
<p>A Bluetooth module provides wireless communication between the Romi and a PC. The module is connected via a UART interface and is used for real-time data streaming, diagnostics, and parameter adjustment during testing.</p>
<p>Streaming is enabled by default on startup and can be toggled through the PC-side interface. This approach reduced onboard memory usage and provided immediate visibility into system behavior during controller tuning and debugging.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md59"></a>
Pin Assignment Summary</h2>
<p>The following table summarizes the primary electrical connections used in the final system configuration. Wire colors are shown explicitly to aid debugging and reproducibility.</p>
<table class="doxtable">
<tr>
<th>Cable</th><th>Contact</th><th>Color</th><th>Signal / Module Pin</th><th>Nucleo Pin</th><th>PDB Pin</th><th>Port</th><th>AF</th><th>Function</th></tr>
<tr>
<td rowspan="2">Encoder (Left)</td><td>1</td><td style="background:#1f77b4;color:white;">Blue</td><td>Encoder Ch. A</td><td>Timer Pin, Ch.1</td><td>ELA or ERA</td><td>PA9</td><td>AF1</td><td>TIM1_CH2</td></tr>
<tr>
<td>2</td><td style="background:#f1c40f;">Yellow</td><td>Encoder Ch. B</td><td>Timer Pin, Ch.2</td><td>ELB or ERB</td><td>PA8</td><td>AF2</td><td>TIM1_CH1</td></tr>
<tr>
<td rowspan="2">Encoder (Right)</td><td>1</td><td style="background:#1f77b4;color:white;">Blue</td><td>Encoder Ch. A</td><td>Timer Pin, Ch.1</td><td>ELA or ERA</td><td>PC7</td><td>AF2</td><td>TIM8_CH2</td></tr>
<tr>
<td>2</td><td style="background:#f1c40f;">Yellow</td><td>Encoder Ch. B</td><td>Timer Pin, Ch.2</td><td>ELB or ERB</td><td>PC6</td><td>AF2</td><td>TIM8_CH1</td></tr>
<tr>
<td rowspan="3">Motor (Left)</td><td>1</td><td style="background:#f1c40f;">Yellow</td><td>Motor Enable</td><td>Digital Output</td><td>nSLP</td><td>PB4</td><td>-</td><td>Enable / Sleep</td></tr>
<tr>
<td>2</td><td style="background:#1f77b4;color:white;">Blue</td><td>Motor Direction</td><td>Digital Output</td><td>DIR</td><td>PB3</td><td>-</td><td>Direction</td></tr>
<tr>
<td>3</td><td style="background:#2ecc71;">Green</td><td>Motor Effort</td><td>Timer Pin</td><td>PWM</td><td>PB5</td><td>AF2</td><td>TIM3_CH2</td></tr>
<tr>
<td rowspan="3">Motor (Right)</td><td>1</td><td style="background:#f1c40f;">Yellow</td><td>Motor Enable</td><td>Digital Output</td><td>nSLP</td><td>PC9</td><td>-</td><td>Enable / Sleep</td></tr>
<tr>
<td>2</td><td style="background:#1f77b4;color:white;">Blue</td><td>Motor Direction</td><td>Digital Output</td><td>DIR</td><td>PB9</td><td>-</td><td>Direction</td></tr>
<tr>
<td>3</td><td style="background:#2ecc71;">Green</td><td>Motor Effort</td><td>Timer Pin</td><td>PWM</td><td>PB8</td><td>AF2</td><td>TIM4_CH3</td></tr>
<tr>
<td rowspan="6">IMU</td><td>-</td><td style="background:#e74c3c;color:white;">Red</td><td>IMU VIN</td><td>-</td><td>5V (CN7)</td><td>-</td><td>-</td><td>Power</td></tr>
<tr>
<td>-</td><td>â€”</td><td>IMU 3vo</td><td>-</td><td>Optional*</td><td>-</td><td>-</td><td>Regulated Output</td></tr>
<tr>
<td>-</td><td style="background:black;color:white;">Black</td><td>IMU GND</td><td>-</td><td>GND (CN7)</td><td>-</td><td>-</td><td>Ground</td></tr>
<tr>
<td>-</td><td style="background:#800020;color:white;">Burgundy</td><td>IMU SDA</td><td>-</td><td>-</td><td>PB14</td><td>AF4</td><td>I2C2_SDA</td></tr>
<tr>
<td>-</td><td style="background:gray;color:white;">Gray</td><td>IMU SCL</td><td>-</td><td>-</td><td>PB13</td><td>AF4</td><td>I2C2_SCL</td></tr>
<tr>
<td>-</td><td style="background:white;">White</td><td>IMU RST</td><td>-</td><td>-</td><td>-</td><td>-</td><td>Reset</td></tr>
<tr>
<td rowspan="4">Bluetooth Module</td><td>1</td><td style="background:white;">White</td><td>Module RX</td><td>Romi TX</td><td>-</td><td>PB6</td><td>AF7</td><td>UART1_TX</td></tr>
<tr>
<td>2</td><td style="background:orange;">Orange</td><td>Module TX</td><td>Romi RX</td><td>-</td><td>PB7</td><td>AF7</td><td>UART1_RX</td></tr>
<tr>
<td>3</td><td style="background:black;color:white;">Black</td><td>Module GND</td><td>Romi GND</td><td>-</td><td>GND (CN7)</td><td>-</td><td>Ground</td></tr>
<tr>
<td>4</td><td style="background:#e74c3c;color:white;">Red</td><td>Module VCC</td><td>Romi 5V</td><td>-</td><td>E5V (CN7)</td><td>-</td><td>Power</td></tr>
<tr>
<td rowspan="5">Battery / Power</td><td>1</td><td style="background:black;color:white;">Black</td><td>Divider Ground</td><td>GND</td><td>-</td><td>GND (CN7)</td><td>-</td><td>Ground</td></tr>
<tr>
<td>2</td><td style="background:#1f77b4;color:white;">Blue</td><td>Divider Node</td><td>ADC Input</td><td>-</td><td>PC2</td><td>-</td><td>Battery Sense</td></tr>
<tr>
<td>3</td><td style="background:#e74c3c;color:white;">Red</td><td>Power to Nucleo</td><td>VIN</td><td>-</td><td>VIN (CN6)</td><td>-</td><td>Board Power</td></tr>
<tr>
<td>4</td><td style="background:black;color:white;">Black</td><td>PDB Ground</td><td>-</td><td>GND</td><td>-</td><td>-</td><td>Ground</td></tr>
<tr>
<td>5</td><td style="background:#e74c3c;color:white;">Red</td><td>PDB Battery Power</td><td>-</td><td>VSW</td><td>-</td><td>-</td><td>Battery</td></tr>
<tr>
<td rowspan="12">Line Sensors</td><td>-</td><td style="background:#e74c3c;color:white;">Red</td><td>Power</td><td>3.3V</td><td>-</td><td>3.3V (CN7)</td><td>-</td><td>Power</td></tr>
<tr>
<td>-</td><td style="background:black;color:white;">Black</td><td>Ground</td><td>GND</td><td>-</td><td>GND (CN7)</td><td>-</td><td>Ground</td></tr>
<tr>
<td>-</td><td style="background:#800020;color:white;">Burgundy</td><td>Sensor 1</td><td>ADC</td><td>-</td><td>PC4</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:#800020;color:white;">Burgundy</td><td>Sensor 3</td><td>ADC</td><td>-</td><td>PA1</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:orange;">Orange</td><td>Sensor 5</td><td>ADC</td><td>-</td><td>PA4</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:#2ecc71;">Green</td><td>Sensor 7</td><td>ADC</td><td>-</td><td>PB0</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:#1f77b4;color:white;">Blue</td><td>Sensor 9</td><td>ADC</td><td>-</td><td>PC1</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:#f1c40f;">Yellow</td><td>Sensor 11</td><td>ADC</td><td>-</td><td>PC0</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:orange;">Orange</td><td>Sensor 2</td><td>ADC</td><td>-</td><td>PA6</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:#2ecc71;">Green</td><td>Sensor 4</td><td>ADC</td><td>-</td><td>PA7</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:gray;color:white;">Gray</td><td>Sensor 6</td><td>ADC</td><td>-</td><td>PA0</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:white;">White</td><td>Sensor 8</td><td>ADC</td><td>-</td><td>PB1</td><td>-</td><td>ADC</td></tr>
<tr>
<td>-</td><td style="background:brown;color:white;">Brown</td><td>Sensor 10</td><td>ADC</td><td>-</td><td>PC3</td><td>-</td><td>ADC</td></tr>
<tr>
<td rowspan="8">Bump Sensors</td><td>-</td><td style="background:black;color:white;">Black</td><td>Ground</td><td>GND</td><td>-</td><td>GND</td><td>-</td><td>Ground</td></tr>
<tr>
<td>-</td><td style="background:#e74c3c;color:white;">Red</td><td>BMP0</td><td>Digital Input</td><td>-</td><td>PH0</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:#2ecc71;">Green</td><td>BMP1</td><td>Digital Input</td><td>-</td><td>PH1</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:orange;">Orange</td><td>BMP2</td><td>Digital Input</td><td>-</td><td>PC10</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:#800020;color:white;">Burgundy</td><td>BMP3</td><td>Digital Input</td><td>-</td><td>PC11</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:gray;color:white;">Gray</td><td>BMP4</td><td>Digital Input</td><td>-</td><td>PC12</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:brown;color:white;">Brown</td><td>BMP5</td><td>Digital Input</td><td>-</td><td>PD2</td><td>-</td><td>Input</td></tr>
<tr>
<td>-</td><td style="background:white;">White</td><td>Ground</td><td>GND</td><td>-</td><td>GND</td><td>-</td><td>Ground</td></tr>
</table>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md61"></a>
Pinout Reference and Wiring Diagram</h2>
<p>The diagram below summarizes the final pin assignments used on the Nucleo board. This diagram was used throughout development to track peripheral usage and avoid conflicts between timers, ADC inputs, and communication interfaces.</p>
<div class="image">
<img src="nucleo_pin_assignment_diagram.png" alt="" width="90%"/>
<div class="caption">
Pin assignment diagram showing connections between the Nucleo board, motors, encoders, sensors, and peripherals.</div></div>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md63"></a>
Discussion</h2>
<p>The hardware and electrical design evolved alongside the firmware throughout the quarter. Careful pin selection, explicit motor enable control, and deliberate startup behavior were critical to achieving reliable and repeatable operation.</p>
<p>By prioritizing modularity and clarity in both wiring and software interfaces, the system remained flexible enough to support experimentation while maintaining a stable configuration for final demonstrations. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
